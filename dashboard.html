<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Clinic Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>

<body class="bg-gray-100">

<!-- NAVBAR -->
<nav class="bg-blue-600 text-white p-4 flex justify-between">
    <h1 class="font-bold text-xl">Clinic Dashboard</h1>
    <div class="space-x-4">
        <a href="dashboard.html" class="hover:underline">Patients</a>
        <a href="reports.html" class="hover:underline">Reports</a>
    </div>
</nav>

<!-- CONTAINER -->
<div class="max-w-4xl mx-auto mt-8 bg-white p-6 shadow rounded">

    <h2 class="text-2xl font-bold mb-4">Add New Patient</h2>

    <form id="patientForm" class="space-y-4">

        <div>
            <label class="block font-semibold">Full Name</label>
            <input id="full_name" class="w-full p-2 border rounded" />
        </div>

        <div>
            <label class="block font-semibold">Age</label>
            <input id="age" type="number" class="w-full p-2 border rounded" />
        </div>

        <div>
            <label class="block font-semibold">Gender</label>
            <select id="gender" class="w-full p-2 border rounded">
                <option value="">Select gender</option>
                <option>Male</option>
                <option>Female</option>
            </select>
        </div>

        <div>
            <label class="block font-semibold">Address</label>
            <input id="address" class="w-full p-2 border rounded" />
        </div>

        <div>
            <label class="block font-semibold">Contact Number</label>
            <input id="contact_no" class="w-full p-2 border rounded" />
        </div>

        <!-- DOCTOR DROPDOWN -->
        <div>
            <label class="block font-semibold">Doctor</label>
            <select id="doctor_id" class="w-full p-2 border rounded">
                <option value="">Select doctor</option>
            </select>
            <p id="doctorError" class="text-red-600 text-sm hidden">Please select a doctor</p>
        </div>

        <div>
            <label class="block font-semibold">Doctor’s Fee</label>
            <input id="doctor_fee" type="number" class="w-full p-2 border rounded" />
        </div>

        <button id="saveBtn" type="button" 
            class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
            Save
        </button>
    </form>

    <p id="statusMessage" class="mt-4 font-semibold"></p>

</div>

<script>
    // -----------------------------
    // Supabase Initialization
    // -----------------------------
    const supabase = supabase.createClient(
        "YOUR_SUPABASE_URL",
        "YOUR_SUPABASE_ANON_KEY"
    );

    // -----------------------------
    // Load doctors into dropdown
    // -----------------------------
    async function loadDoctors() {
        const { data, error } = await supabase
            .from("doctors")
            .select("*")
            .order("name");

        if (error) {
            console.error("Error loading doctors:", error);
            return;
        }

        const dropdown = document.getElementById("doctor_id");
        dropdown.innerHTML = `<option value="">Select doctor</option>`;

        data.forEach(doc => {
            const opt = document.createElement("option");
            opt.value = doc.id;
            opt.textContent = doc.name;
            dropdown.appendChild(opt);
        });
    }

    loadDoctors();


    // -----------------------------
    // Save Patient Function
    // -----------------------------
    document.getElementById("saveBtn").addEventListener("click", async () => {
        
        const full_name = document.getElementById("full_name").value;
        const age = document.getElementById("age").value;
        const gender = document.getElementById("gender").value;
        const address = document.getElementById("address").value;
        const contact_no = document.getElementById("contact_no").value;
        const doctor_id = document.getElementById("doctor_id").value;
        const doctor_fee = document.getElementById("doctor_fee").value;

        // Validate doctor field
        if (!doctor_id) {
            document.getElementById("doctorError").classList.remove("hidden");
            return;
        } else {
            document.getElementById("doctorError").classList.add("hidden");
        }

        const { data, error } = await supabase
            .from("patients")
            .insert([
                {
                    full_name,
                    age,
                    gender,
                    address,
                    contact_no,
                    doctor_id,
                    doctor_fee
                }
            ]);

        const statusMessage = document.getElementById("statusMessage");

        if (error) {
            console.error("Insert error:", error);
            statusMessage.textContent = "❌ Failed to save patient.";
            statusMessage.className = "text-red-600 font-semibold";
        } else {
            statusMessage.textContent = "✅ Patient saved successfully!";
            statusMessage.className = "text-green-600 font-semibold";
            document.getElementById("patientForm").reset();
        }
    });
</script>

</body>
</html>
